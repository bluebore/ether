<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>快速入门 - Baidu File System</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">Baidu File System</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">CN <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li class="active">
    <a href="./">快速入门</a>
</li>
                            
<li >
    <a href="../README/">README</a>
</li>
                            
<li >
    <a href="../api/">API</a>
</li>
                            
<li >
    <a href="../bfs_desigin/">总体设计</a>
</li>
                            
<li >
    <a href="../bfs_HA/">HA设计</a>
</li>
                            
<li >
    <a href="../bfs_mount/">Mount设计</a>
</li>
                            
<li >
    <a href="../bfs_qa/">串讲问题</a>
</li>
                            
<li >
    <a href="../committer/">committer</a>
</li>
                            
<li >
    <a href="../design/">design</a>
</li>
                            
<li >
    <a href="../dir_lock/">dir_lock</a>
</li>
                            
<li >
    <a href="../DiskManager/">DiskManager</a>
</li>
                            
<li >
    <a href="../easy_fix/">easy_fix</a>
</li>
                            
<li >
    <a href="../file_lock/">file_lock</a>
</li>
                            
<li >
    <a href="../garbage_collection/">garbage_collection</a>
</li>
                            
<li >
    <a href="../HA_log_compress/">HA_log_compress</a>
</li>
                            
<li >
    <a href="../how_to_contribute/">how_to_contribute</a>
</li>
                            
<li >
    <a href="../log_rule/">log_rule</a>
</li>
                            
<li >
    <a href="../requirement/">requirement</a>
</li>
                            
<li >
    <a href="../roadmap/">roadmap</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">EN <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../en/README/">README</a>
</li>
                            
<li >
    <a href="../../en/roadmap/">RoadMap</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../..">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../README/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#_1">快速上手</a></li>
            <li><a href="#10">10分钟快速体验</a></li>
            <li><a href="#_2">从入门到精通</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="_1">快速上手</h1>
<p>快速也分两种，一种不求甚解的10分钟快速体验，一种是知其然又知其所以然。</p>
<h2 id="10">10分钟快速体验</h2>
<ol>
<li>构建BFS<br />
<code>./build.sh</code><br />
   build.sh会自动下载、编译所有依赖，并最后编译出nameserver、chunkserver、bfs_client、libbfs.a几个二进制。<br />
   注：这步如果发现什么问题，可以直接提<code>Issue</code>，当然我们也欢迎你自己解决的提<code>Pull request</code>。</li>
<li>部署BFS<br />
<code>cd sandbox;</code><br />
<code>./deploy.sh</code><br />
   deploy.sh 会自动部署一套有1个nameserver,4个chunkserver的模拟集群环境。  </li>
<li>启动BFS<br />
<code>./start_bfs.sh</code><br />
   start_bfs.sh会启动前面异步部署的模拟集群环境<br />
   可以通过 <code>./bfs_client stat</code> 查看集群后启动情况，也可以通过<code>http://localhost:8828</code> 查看web页面信息<br />
   看到4个活的chunkserver, 说明集群启动成功.  </li>
<li>使用bfs_client体验BFS<br />
   可以使用bfs_client与集群交互，直接输入<code>./bfs_client</code>可以看到提示，<br />
   这里举几个例子：<br />
   list： ./bfs_client ls /<br />
   touchz: ./bfs_client touchz /empty_file<br />
   put: ./bfs_client put bfs_client /<br />
   get: ./bfs_client get /bfs_client ./bfs_client.bak  </li>
<li>使用SDK访问BFS<br />
   待完善...</li>
<li>使用bfs_mount把BFS挂载到本地文件系统<br />
   安装fuse(版本2.6以上2.8及以下)<br />
   修改bfs文件夹下的Makefile，添加<code>FUSE_PATH=fuse安装路径</code><br />
<code>make</code>产生可执行文件<code>bfs_mount</code><br />
   使用前面的步骤启动集群<br />
   挂载：直接输入<code>./bfs_mount</code>可以看到使用提示<br />
   例子：<code>./bfs_mount /mnt/bfs -d -c 127.0.0.1:8827 -p /</code>  </li>
</ol>
<h2 id="_2">从入门到精通</h2>
<h3 id="bfs">为什么使用BFS</h3>
<p>传统的分布式文件系统(如HDFS)Namenode是一个单点，容量和吞吐量都不以扩展，同时使用外部的日志同步工具（如QJM、ZooKeeper）failover时间是分钟级的。<br />
BFS主要从扩展性和持续可用两个方面做了改进，采用分布式的NameServer，多NameServer之间使用内置的Raft协议做日志同步，保证failover时，新主一定有最新的状态不需要额外日志同步，解决了扩展性和可用性问题。  </p>
<h3 id="bfs_1">BFS部署</h3>
<h4 id="_3">依赖</h4>
<p>BFS使用了C++实现，所以部署不依赖Java虚拟机。<br />
BFS内置一致性协议选主，所以部署不依赖外部协调模块。<br />
总之，BFS的部署不依赖外部系统，但你需要有一个主流的Linux发行版：RedHat、CentOS或者Ubuntu，并有Gcc4.8及以上版本编译器。  </p>
<h4 id="_4">配置</h4>
<p>一个典型的bfs配置文件:<br />
# 公共配置<br />
--bfs_log=../log/bfs.log   # log文件的存储路径<br />
--bfs_log_size=5120        # 单个log文件的大小<br />
--bfs_log_limit=1024000    # 总的log限制,超过限制会删除旧的log<br />
--bfs_log_level=4          # 日志级别 DEBUG = 2, INFO = 4, WARNING = 8, FATAL = 16,<br />
--nameserver_nodes=ns1.baidu.com:8828,ns2.baidu.com:8828,ns3.baidu.com:8828   # NameServer节点列表  </p>
<p>#NameServer配置<br />
--ha_strategy=raft         # NameServer的HA策略, none,raft,master-slave 3选一<br />
--node_index=0             # 当前节点是NameServer节点列表的第几个<br />
--keepalive_timeout=30     # ChunkServer心跳超时时间<br />
--namedb_path=/ssd1/meta   # NameServer的meta信息存储路径<br />
--default_replica_num=3    # 默认文件副本数  </p>
<p>#ChunkServer配置<br />
--chunkserver_max_unfinished_byte=2147483648 # 未完成的写请求会占用ChunkServer内存,为避免OOM,设置了一个上限超出后就拒绝新请求.<br />
--block_store_path=/home/disk1,/home/disk2   # 数据存储目录, 每个磁盘指定一个  </p>
<p>#SDK配置
--sdk_file_reada_len=10485760                # 文件预读最大长度，当判断用户在顺序读文件时，会自动开启预读。  </p>
<h4 id="_5">分布式部署</h4>
<p>BFS的分布式部署一般包含3或5个NameServer节点和3+个ChunkServer节点。<br />
1. 在每个bfs.flag里通过<code>nameserver_nodes</code>指定所有NameServer的主机名和端口<br />
2. 在NameServer的bfs.flag里通过<code>node_index</code>指定NameServer对应的序号<br />
3. 以任意顺序或并发<code>启动3个NameServer</code><br />
4. 在ChunkServer的bfs.flag里通过block_store_path指定ChunkServer使用的<code>磁盘路径</code>，并确保chunkserver对这个路径拥有<code>写权限</code>。<br />
5. 以任意顺序或并发<code>启动所有的chunkserver</code><br />
6. 通过<code>./bfs_client stat检查集群状态</code>，如果看到所有的chunkserver存活，即搭建完成  </p>
<h3 id="bfs_2">BFS使用</h3>
<p>使用Demo参考<a href="https://github.com/baidu/bfs/blob/master/src/client/bfs_client.cc">src/client/bfs_client.cc</a></p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
